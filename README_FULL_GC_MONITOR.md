# Full GC监控脚本使用说明

## 功能概述

这个Shell脚本用于监控服务器上多个Java程序的Full GC情况，支持Java 8和11版本。

## 主要功能

1. **自动检测Java环境** - 检查Java和jps命令是否可用
2. **进程发现** - 通过jps命令获取所有运行的Java进程（排除jps自身）
3. **GC监控** - 使用jstat检查每个进程的Full GC情况
4. **版本适配** - 自动适配Java 8和11的不同jstat输出格式
5. **详细报告** - 提供颜色化的监控报告

## 使用方法

### 基本使用
```bash
./monitor_full_gc.sh
```

### 查看帮助
```bash
./monitor_full_gc.sh --help
```

### 查看版本
```bash
./monitor_full_gc.sh --version
```

## 环境要求

- **操作系统**: Linux/Unix系统（支持bash）
- **Java环境**: JDK 8或11（包含jps和jstat命令）
- **权限**: 需要权限访问Java进程的GC信息

## 输出示例

```
[INFO] 2025-09-25 15:30:00 - 检测到Java版本: 1.8.0_292
[INFO] 2025-09-25 15:30:00 - 正在获取Java进程列表...
[INFO] 2025-09-25 15:30:00 - 发现 3 个Java进程
[INFO] 2025-09-25 15:30:00 - 检查进程 1234 (com.example.Main) 的GC情况...
[SUCCESS] 2025-09-25 15:30:00 - 进程 1234 (com.example.Main) 未检测到Full GC
----------------------------------------
[INFO] 2025-09-25 15:30:00 - 检查进程 5678 (org.apache.tomcat.Main) 的GC情况...
[WARN] 2025-09-25 15:30:00 - 进程 5678 (org.apache.tomcat.Main) 检测到Full GC:
  - Full GC次数: 5
  - Full GC总时间: 1.234秒
----------------------------------------
```

## 技术说明

### Full GC检测原理
脚本使用`jstat -gc`命令获取GC统计信息：
- **Java 8**: 解析第15列(FGC)和第16列(FGCT)
- **Java 11**: 解析第15列(FGC)和第16列(FGCT)

### 进程排除逻辑
脚本会自动排除以下进程：
- `jps`进程本身
- `Jps`进程（不同系统可能大小写不同）

### 错误处理
- 如果Java环境不可用，脚本会提示错误
- 如果jstat命令不可用，脚本会终止执行
- 如果无法访问某个进程的GC信息，会显示警告

## 注意事项

1. **权限要求**: 需要足够的权限来读取其他Java进程的GC信息
2. **性能影响**: jstat命令对性能影响很小，适合生产环境使用
3. **版本兼容**: 主要测试Java 8和11，其他版本可能需要调整
4. **定时任务**: 可以结合cron实现定时监控

## 集成到监控系统

可以将此脚本集成到现有的监控系统中：

```bash
# 定时执行（每5分钟）
*/5 * * * * /path/to/monitor_full_gc.sh >> /var/log/full_gc_monitor.log 2>&1

# 结合告警系统
./monitor_full_gc.sh | grep "检测到Full GC" && send_alert "发现Full GC"
```

## 故障排除

### 常见问题

1. **"jps命令不可用"**
   - 确保安装了完整的JDK（不只是JRE）
   - 检查PATH环境变量包含JDK的bin目录

2. **"无法获取进程GC信息"**
   - 检查是否有权限访问目标进程
   - 确认进程是否仍在运行

3. **"无法解析GC数据"**
   - 可能是Java版本不兼容
   - 检查jstat输出格式是否变化

### 调试模式
可以临时添加`set -x`到脚本开头来启用调试输出。

## 版本历史

- v1.0: 初始版本，支持Java 8和11的基本Full GC监控